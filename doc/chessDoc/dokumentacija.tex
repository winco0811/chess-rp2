\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[croatian]{babel}

\title{Dokumentacija - Šah, Računarski prakitkum 2}
\author{Dora Raštegorac, Vinko Lovrenčić i Luka Jandrijević}
\date{July 2021}

\begin{document}

\maketitle

\section{rules.js, play.html}
\subsection{Varijable}
Na početku koristimo angular kako bi stvorili zasebne "box"-ove odnosno ša\-ho\-vska po\-lja. Pomoću toga sada imamo box-$x$-$y$ gdje $x$ i $y$ označavaju koordinate tog polja.

Na početku \verb|$(document).ready(function())|, na liniji $12$, de\-fi\-ni\-ra\-mo \\ 
\verb|chessPieces| u kojima se nalaze slike određenih figura. Slike figura prikazujemo HTML kodom. Tako na primjer string "\&\#9812" označava sliku bijelog kralja i tako dalje...

Varijabla \verb|player| je zadužena za pratiti koji igrač je trenutno na redu, bijeli ili crni. Na početku je jednaka white jer je na početku bijeli na potezu. Varijabla \verb|promotion| će nam pomoći da postavimo potrebne podatke pri promociji pijuna.

Pomoću varijable \verb|select| pratimo može li se zadana figura micati, tip figure te pozicija figure, odnosno u kojem box-u se nalazi.

\subsection{Postavljanje ploče}
Na liniji $48$, pozivamo funkciju koja je zadužena da polju s koordinatama $i$ i $j$ pridruži klasu \verb|dark-box|, odnosno \verb|light-box| ovisno o tome je li \verb|i+j| paran ili neparan broj. Time dobivamo šahovnicu. S funkcijom \verb|setNewBoard(box,i,j)| na polje sa koordinatama $(i,j)$ postavljamo figuru ako se na početku igre tamo treba prikazati ta figura. Figuru postavljamo na zadano polje s funkcijom  \\
\verb|setPiece(box,color,type)|. Na kraju još pozivamo funkciju \verb|setTheme()| koja pomoču jQuery-a postavlja \verb|light-box| i \verb|dark-box| na zadanu boju.

\subsection{Click event funkcije}

Nakon postavljanje ploče definiramo funkciju koja je zadužena za click evente. Prvo obrađujemo slučaj ako je pijun promaknut. Odabirom od ponuđenih figura, ona se postavlja na potrebnu poziciju i postavlja klasu \verb|placed|.

Kada kliknemo na polje tada se poziva funkcija zadužena za klik na klasu \verb|box|. Ako je taj box, odnosno polje već od prije bilo odabrano to jest, ima klasu \verb|selected|, tada se ta klasa za to polje briše i klasa \verb|suggest| koja označava moguća polja kojom se ta figura može kretati također briše, a varijablu \verb|select| postavljamo na originalne vrijednosti.

Sljedeće što moramo provjeriti je slučaj ako se figura može micati. U tom slučaju znamo da se u \verb|select.piece| nalaze sve potrebne informacije o figuri, boja i tip. Prvo provjerimo ako je odabrana druga figura iste boje. Ako je, tada odabiremo tu figuru. Figuru možemo pomaknuti samo na ona polja koja imaju klasu \verb|suggest|. Ako taj box ima klasu \verb|suggest|, tada pomoću funkcije \verb|setPiece(box, color, type)| postavljamo tu figuru na zadano polje (box) i brišemo prethodno polje. Varijablu \verb|select| opet vraćamo na originalne vrijednosti te mijenjamo igrača.





\subsection{setPiece(box,color,type)}
Funkcija \verb|setPiece(box,color,type)| na početku provjerava je li figura "pojela" kralja na tom polju. Ako je, tada se poziva \verb|showWinner()|, odnosno igra je završena. Dodatno, ona još provjerava je li pijun u poziciji za promaknuće. Varijabla \verb|j| će nam reći na kojem rangu se nalazi figura. Ako je pijun u poziciji za promaknuće, tada se igra "zatamnjuje" pomoću \verb|opacity| te pomoću jQuery-a prikazujemo popis figura u koje se pijun može promaknuti. Na kraju jednostavno postavimo HTML tekst u određeni HTML znak figure.

\subsection{deleteBox(box)}

Ova funkcija briše figuru sa određenog polja. Također briše klasu \verb|placed| i \verb|selected| sa određenog polja.

\subsection{getNextMoves(selectedPiece, selectedBox)}

Funkcijom \verb|getNextMoves| dohvaćamo moguće poteze odabrane figure. Prvo dohvatimo informacije o figuri i spremimo ih u određene varijable. Zatim na sličan način dohvatimo i koordinate na kojima se ta figura nalazi. Ovisno o tome o kojoj figuri je riječ, pozivamo funkciju koja u varijablu \verb|nextMoves| vraća sve moguće poteze te figure. Toj funkciji prosljeđujemo parametar \verb|offset| koja predstavlja u kojim sve smjerovima se određena figura može micati.

Sastoji se od niza $[x,y]$ pri čemu $x$ predstavlja pomak u okomitom smjeru dok $y$ predstavlja pomak u vodoravnom smjeru. Tako na primjer top (eng. "rook") ima postavljen \verb|offset| na $\left[[0,1],[0,-1],[1,0],[-1,0]\right]$ jer se top može po pravilima micati gore,dolje,lijevo i desno. Za pijuna imamo u \verb|offset|-u i $[0,2]$ odnosno $[0,-2]$ jer kad je pijun na početnom položaju onda se može micati za $2$ polja gore odnosno dolje, ovisno o tome o kojoj boji je riječ.

Za konja (eng. knight) \verb|offset| ima niz $[2,-1]$ jer konj se može kretati za $2$ polja gore i jedno polje ulijevo.Slično kao i za topa smo postavili i \verb|offset| drugim varijablama.

\subsection{pawnMoves(i, j, color, moves)}

S ovom funkcijom dohvaćamo moguće poteze pijuna. U \verb|tI| spremamo okomiti smjer a u varijablu \verb|tJ| vodoravni smjer micanja figure. Prolazimo kroz varijablu \verb|offset| te provjeravamo hoćemo li otići izvan granica ploče za odabranu figuru. Ako nećemo, tada provjeravamo još nalazi se na putu neka druga figura (to radimo pomoću klase placed). Sve te moguće poteze spremamo u \verb|nextMoves| te ju nakraju funkcije vraćamo.

\subsection{knightMoves(i, j, color, moves)}

Ovom funkcijom dohvaćamo moguće poteze konja i kralja. Slično kao i prije, ako se na tom mjestu nalazi protivnikova figura tada ta figura može otići na to mjesto. To provjeravamo sa \verb|indexOf(color)| koja vraća negativnu vrijednost ako ne pronađe index na kojem se nalazi podstring "color".

\subsection{otherPiecesMoves(i, j, color, moves)}

Ovom funkcijom dohvaćamo moguće poteze ostalih figura (kraljica, lovac, top). Ovdje koristimo varijablu \verb|sugg| pomaže u detektiranju ako se neka figura nalazi na putu mogućih poteza. U tom slučaju gledamo je li ta figura protivnikova ili nije. Ako je protivnikova tada se i tamo možemo micati s tom figurom. U suprotnom, ne možemo jesti svoje figure pa se dalje ne možemo kretati.

\subsection{suggestNextMoves}

Funkcija pomoću koje za sve legalne poteze dodajemo tim poljima klasu \\
\verb|suggest|.

\subsection{selectPiece(box)}

Odabirom na figuru pozivamo ovu funkciju. Tom polju dodajemo klasu \verb|selected| te u varijablu \verb|select| postavljamo navedene vrijednosti. Dohvaćamo legalne poteze i sugeriramo na koja sva polja se figura može kretati.

\section{Main page}
U dokumentu  \textit{main2.html} nalazi se view glavne stranice web aplikacije. \newline \newline
Omogućili smo korisniku da u tražilicu upiše korisničko ime osobe protiv koje bi htio igrati i pošalje mu zahtjev. Ako ta druga osoba prihvati oboje su preusmjereni na stranicu sa igrom šah. (Vinkov dio)
\newline\newline
Kako bi izbjegli stalno refreshanje stranice pri korisnikovom pretraživanju, listu osoba s tim ili sličnim korisničkim imenom dobivamo uz pomoć ajax-a kojeg pozivamo na dokument \textit{main3.php}
\newline \newline
Linije 28-31: naznačujemo da će se ta funkcija pozvati, tj.izvršiti samo kad korisnik pritisne gumb Search
\newline \newline
Linije 34-58: funkcija u kojoj se nalazi ajax. Ako je uspješan u listu ću upisati element liste koji vraća stranica \textit{main3.php}
\newline \newline
Linije 62-72: imamo ponavljanje koda sa stranice za login - dio koji upućuje korisnika na pomoć pri učenju igranja šaha
\newline \newline
Linija 78: link na stranicu za Logout koji smo u css-u oblikovali da izgleda kao gumb\newline

\subsection{style for main page}

Linije 9-27: navodimo svojstva scrollbar-a kojeg ima/će imati lista korisnika
\newline\newline
Linije 36-50: pozicioniramo naslov na stranici i navodimo njegova osnovna svojstva. Posebno, linije 46-49 zaobljuju bridove naslova - tu metodu koristimo i u oblikovanju ostalih div-ova
\newline\newline
Linije 52-80: Definiramo izgled \nless h1  \ngtr, \nless h2 \ngtr i \nless h3 \ngtr tag-ova
\newline\newline
Linije 82-90: pozicioniranje i definiranje diva u koji će stizati za poruku/obavijest - biti će hidden dok nema poruke
\newline\newline
Linije 92-113: Oblikujemo kućicu za unos teksta kod pretraživanja
\newline\newline
Linije 111-121: pozicioniramo kućicu za upis imena
\newline\newline
Linije 124-132: pozicioniramo i oblikujemo gumb Search
\newline\newline
Linije 134-149: oblikujemo i pozicioniramo div koji sadrži kućicu za pretraživanje imena
\newline\newline
Linije 151-164: oblikujemo i pozicioniramo div koji sadrži listu korisničkih imena koja su pretražena
\newline\newline
Linije 166-179: Oblikujemo listu i elemente liste
\newline\newline
Linije 181-197: oblikuju div u kojem se nalaze linkovi
\newline\newline
Linije 199-206: pozicioniranje linkova unutar div-a
\newline\newline
Linije 208-232: oblikujemo link za Log out da izgleda kao gumb \newline(212-215: obikujemo rubove, 217-224: zadajemo veličine i pozicioniramo, 226-229: zaobljujemo rubove)
\newline\newline
Od linije 234 uz pomoć @media naša stranica postaje responzivna.
Uz svaki @media odredimo za koje veličine ekrana vrijedi i unutar njega unosimo izgled div-ova kojih želimo da se vide, za pojedine za koje ne želimo da se vide samo stavimo display:none;


\subsection{main3.php}

Sličan dokument ovom smo prošli na predavanjima. Jedina razlika je što u ovom prvo pristupamo bazi i iz nje izvlačimo potrebne podatke u polje te onda, ako polje nije prazno, vraćamo element liste koji sadrži ime osobe i gumb s kojim korisnik tu osobu zove na igru

\section{style za login i register}

Linije 15-29: oblikuju i pozicioniraju div u kojem se nalazi forma za login/register
\newline\newline
Linije 31-46: oblikuju i pozicioniraju div u kojem se nalazi tekst i slika
\newline\newline
Linije 48-56: obilikovanje \nless h3 \ngtr tag-a
\newline\newline
Linije 58-66: pozicioniranje i oblikovanje slike šah
\newline\newline
Linije 68-76: obilikovanje  \nless h2 \ngtr tag-a
\newline\newline
Linije 78-84: pozicioniranje forme za login/register
\newline\newline
Linije 86-103: oblikovanje kućica u koje korisnik unosi podatke
\newline\newline
Linije 103-110: oblikovanje forme
\newline\newline
Linije 113-121: pozicioniranje gumba za login
\newline\newline
Linije 123-142: pozicioniranje gumba za register
\newline\newline
Linije 152-159: oblikovanje linkova za pomoć pri učenju
\newline\newline
Linije 165-179: oblikovanje linkova
\newline\newline

Od linije 187 uz pomoć @media naša stranica postaje responzivna.
Uz svaki @media odredimo za koje veličine ekrana vrijedi i unutar njega unosimo izgled div-ova kojih želimo da se vide, za pojedine za koje ne želimo da se vide samo stavimo display:none;

\section{view, login/register i logout}

\subsection{chess.php}
Početna stranica aplikacije je \verb|chess.php| u kojem korisnik mora unijeti username i password kako bi nastavio dalje. \verb|chess.php| prvo crta log-in formu te prati koji gumb je kliknut te ovisno o kliknutom gumbu prikazuje određenu stranicu. Ukoliko korisnik prvi put pristupa aplikaciji, tada se mora registrirati pritiskom na gumb register. Klikom na taj gumb korisnika se prosljeđuje na stranicu za registriranje u kojem je potrebno upisati željeni username i password te svoju email adresu. Ako je korisnik krivo utipkao email adresu o tome se javlja greška. Ako username već postoji tada se opet javlja greška i ispisuje poruka.

\subsection{login}

U \verb|login.php| imamo dvije funkcije: \verb|procesiraj_login()| i \verb|procesiraj_novi()|. Prva funkcija provjerava da li se u varijabli \verb|POST| nalazi username i je li taj username valjan. Zatim iz baze podataka dohvaća taj username te provjerava je li se hashirane šifre podudaraju. Ako je sve dobro tada otvara novu sesiju, u tu sesiju sprema username korisnika te ga prosljeđuje na iduću stranicu. Funkcija \verb|procesiraj_novi()| se poziva pri registraciji. Ona služi da kada se korisnik ide registrirati tada u bazu podataka sprema tog korisnika sa unesenim username-om i passwordom.

\subsection{register.php, processRegistration.php}

U \verb|register.php| se nalazi funkcija koja služi za crtanje forme pri registraciji korisnika. Nju pozivamo u \verb|processRegistration.php| kada korisnik još nije kliknuo na gumb register. Jednom kada je kliknuo gumb register, poziva se funkcija \verb|procesiraj_novi()| iz \verb|login.php|.

\end{document}
